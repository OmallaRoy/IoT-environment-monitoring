{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="dashboard-header text-center mb-5">
    <h1 class="display-4 fw-bold text-dark">Smart Environment System</h1>
    <p class="lead text-muted">Live data (temperature,humidity,battery and motion today)</p>
</div>

<!-- Stats Cards -->
<div class="row">
    <div class="col-md-3 mb-4">
        <div class="card stat-card">
            <div class="card-body text-center">
                <div class="stat-value" id="current-temp">--</div>
                <div class="stat-label">Temperature (Â°C)</div>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card stat-card">
            <div class="card-body text-center">
                <div class="stat-value" id="current-humidity">--</div>
                <div class="stat-label">Humidity (%)</div>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card stat-card">
            <div class="card-body text-center">
                <div class="stat-value" id="current-battery">--</div>
                <div class="stat-label">Battery (V)</div>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card stat-card">
            <div class="card-body text-center">
                <div class="stat-value" id="current-motion">--</div>
                <div class="stat-label">Motion Today</div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                <h4>Real-Time Data Visualization(Charts)</h4>
                <p class="text-muted">Discover trends through real-time interactive charts</p>
                <a href="{% url 'charts' %}" class="btn btn-primary">View Data Charts</a>
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <i class="fas fa-brain fa-3x text-success mb-3"></i>
                <h4>Predicted Temperature & Humidity</h4>
                <p class="text-muted">View AI-predicted environmental data</p>
                <a href="{% url 'auto_predict' %}" class="btn btn-success">View Predictions</a>
            </div>
        </div>
    </div>
</div>

<style>
.stat-card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: center;
    border-left: 4px solid #007bff;
    height: 100%;
}
.stat-value {
    font-size: 2.5em;
    font-weight: bold;
    color: #007bff;
    margin: 10px 0;
}
.stat-label {
    font-size: 1.1em;
    color: #6c757d;
    font-weight: 500;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Fetch latest sensor data from ThingSpeak
async function fetchLatestData() {
    const channelId = "3077306";
    const readApiKey = "RJKY2M6KAC4APH45";
    
    try {
        const response = await fetch(`https://api.thingspeak.com/channels/${channelId}/feeds.json?api_key=${readApiKey}&results=10`);
        const data = await response.json();
        
        if (data.feeds && data.feeds.length > 0) {
            const latest = data.feeds[data.feeds.length - 1];
            
            // Update stats cards
            document.getElementById('current-temp').textContent = parseFloat(latest.field4 || 0).toFixed(1);
            document.getElementById('current-humidity').textContent = parseFloat(latest.field2 || 0).toFixed(1);
            document.getElementById('current-battery').textContent = parseFloat(latest.field1 || 0).toFixed(2);
            document.getElementById('current-motion').textContent = parseInt(latest.field3 || 0);
        }
    } catch (error) {
        console.error('Error fetching data:', error);
    }
}

// Load data on page load
document.addEventListener('DOMContentLoaded', function() {
    fetchLatestData();
    // Refresh every 2 minutes
    setInterval(fetchLatestData, 120000);
});
</script>
{% endblock %}